<!doctype html>
<html lang='en'>
<head>
	<meta charset='utf-8'>
	<meta name='description' content='A Cinema Application for two Spec A databases side by side'>
	<meta name='author' content='Cameron Tauxe'>
	<link rel='stylesheet' href='../css/cinemaWebApp.css'>
	<!-- jquery -->
	<script src='../lib/jquery-3.1.1.min.js'></script>
	<!-- cvlib -->
    <script src='../js/Parameter.js'></script>
    <script src='../js/QuerySet.js'></script>
    <script src='../js/ResultSet.js'></script>
    <script src='../js/UIFactory.js'></script>
    <script src='../js/ControlsBasic.js'></script>
	<script src='../js/ControlsPhiTheta.js'></script>
    <script src='../js/Database.js'></script>
    <script src='../js/DatabaseSpecA.js'></script>
    <script src='../js/Renderer.js'></script>
    <script src='../js/RendererSpecA.js'></script>
	<!-- webApp specific -->
	<script src = '../js/webapp/BuildViewer.js'></script>
	<script src = '../js/webapp/BuildSingleContent.js'></script>
	<script src = '../js/webapp/BuildMatrixContent.js'></script>
	<script src = '../js/webapp/BuildSearchContent.js'></script>
	<script src = '../js/webapp/BuildCompare2Content.js'></script>
	<script src = '../js/webapp/BuildCompare4Content.js'></script>
	<script src = '../js/webapp/BuildDoubleContent.js'></script>
	<script src = '../js/webapp/BuildLabel.js'></script>
</head>
<body>
	<header id="header">
		<h1 id="title">
			Cinema Spec A Double Viewer
		</h1>
	</header>

	<div id="leftControlsPane" class="controlsPane" side="left">
		<div id="launchPanel" class="controlPanel">
			<div class="controlTitle">
				Database Select
			</div>
			<div class="controlSubPanel">
				Database 1:
				<select id="databaseSelect1">
					<option value="data/magnitude-volume-halos-time/info.json">Cosmology</option>
					<option value="data/volume-render/info.json">Volume Render</option>
				</select>
				<br>
				Database 2:
				<select id="databaseSelect2">
					<option value="data/magnitude-volume-halos-time/info.json">Cosmology</option>
					<option value="data/volume-render/info.json">Volume Render</option>
				</select>
			</div>
			<button class="loadButton" mode="launch" onclick="onLaunch()">Launch</button>
		</div>
	</div>

	<div id="contentPane" class="contentPane" side="both"></div>

	<div id="rightControlsPane" class="controlsPane" side="right"></div>

	<script>
		var onLaunch = function() {
			var database1Path = $('#databaseSelect1').val();
			var database2Path = $('#databaseSelect2').val();

			//clear content and control panes
			$('div.visControls').remove();
			$('div.visContents').remove();

			buildViewer(database1Path, database2Path, function() {
				$('#launchPanel').insertAfter($('#leftControlsPane').find('div.visControls'));
			});
		}

		var buildViewer = function(database1Path, database2Path, callback) {
			var database1, database2;
			var querySet1, querySet2;
			var loadsRemaining = 2;

			database1 = new CVLIB.DatabaseSpecA(database1Path, function(qs) {
				querySet1 = qs;
				loadsRemaining--;
				if(loadsRemaining == 0) {
					doneLoading();
				}
			});
			database2 = new CVLIB.DatabaseSpecA(database2Path, function(qs) {
				querySet2 = qs;
				loadsRemaining--;
				if(loadsRemaining == 0) {
					doneLoading();
				}
			});

			var doneLoading = function() {
				var contents = buildDoubleContent(database1, querySet1, database2, querySet2);

				$('#leftControlsPane').append(contents.controls1);
				var leftControlsPaneWidth = $(contents.controls1).outerWidth(true);
				$('#leftControlsPane').css('width', leftControlsPaneWidth + 'px');

				$('#rightControlsPane').append(contents.controls2);
				var rightControlsPaneWidth = $(contents.controls2).outerWidth(true);
				$('#rightControlsPane').css('width', rightControlsPaneWidth + 'px');
				
				$('#contentPane').css('margin-right',rightControlsPaneWidth + 50 + 'px');
				$('#contentPane').css('margin-left',leftControlsPaneWidth + 50 + 'px');

				$('#contentPane').append(contents.content);

				callback();
			}
		};
	</script>

</body>	